<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reservas - TUDECA</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 0;
    }

    h2 {
      color: #333;
    }

    select, input, button {
      margin: 10px 0;
      padding: 8px;
      font-size: 14px;
    }

    .habitaciones {
      margin-top: 20px;
    }

    .habitaciones button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 14px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
    }

    .habitaciones button.reservada {
      background-color: red;
      cursor: not-allowed;
    }

    #formulario-reserva {
      display: none;
      margin-top: 20px;
      padding: 15px;
      background: #fff;
      border: 1px solid #ccc;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input[type="text"], input[type="email"], input[type="tel"], input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }

    #mensaje {
      margin-top: 15px;
      color: green;
    }

.title {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 24px;
  color: white;
  font-weight: bold;
}
        .signup-btn-link {
            display: inline-block;
            background-color: #5a9352;
            color: white;
            text-decoration: none;
            padding: 10px 25px;
            font-weight: bold;
            border-radius: 2px;
        }

        .signup-btn-link:hover {
            background-color: #4a7946;
        }
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #5a9352;
            padding: 10px 20px;
        }

  </style>
</head>
<body>
    <div class="navbar">
      <div class="title">TUDECA</div>
      <div><a href="index.html" class="signup-btn-link">Inicio</a></div>
    </div>
  <h2>Reservar Habitación</h2>

  <label for="hotelSelect">Selecciona un hotel:</label>
  <select id="hotelSelect"></select>

  <div class="habitaciones" id="habitaciones"></div>

  <form id="formulario-reserva">
    <h3>Formulario de Reserva</h3>
    <input type="hidden" id="hotel_id" />
    <input type="hidden" id="num_habitacion" />

    <label for="nombre_huesped">Nombre del huésped:</label>
    <input type="text" id="nombre_huesped" required />

    <label for="correo">Correo:</label>
    <input type="email" id="correo" required />

    <label for="celular">Celular:</label>
    <input type="tel" id="celular" required />

    <label for="fecha_inicio">Fecha de inicio:</label>
    <input type="date" id="fecha_inicio" required />

    <label for="fecha_fin">Fecha de fin:</label>
    <input type="date" id="fecha_fin" required />

    <button type="submit">Reservar</button>
  </form>

  <div id="mensaje"></div>

  <script>
    let reservas = [];
    const hotelSelect = document.getElementById('hotelSelect');
    const habitacionesDiv = document.getElementById('habitaciones');
    const formulario = document.getElementById('formulario-reserva');
    const mensajeDiv = document.getElementById('mensaje');

    // Obtener hoteles
    async function cargarHoteles() {
      const res = await fetch('/hoteles');
      const hoteles = await res.json();

      hotelSelect.innerHTML = '<option value="">--Selecciona--</option>';
      hoteles.forEach(hotel => {
        const option = document.createElement('option');
        option.value = hotel.id;
        option.textContent = hotel.nombre;
        hotelSelect.appendChild(option);
      });
    }

    // Obtener reservas existentes
    async function cargarReservas() {
      const res = await fetch('/reservas');
      reservas = await res.json();
    }

    // Generar botones de habitaciones
    async function generarHabitaciones(hotelId) {
      habitacionesDiv.innerHTML = '';
      formulario.style.display = 'none';
      mensajeDiv.textContent = '';

      const res = await fetch(`/hotel/${hotelId}`);
      const hotel = await res.json();

      for (let i = 1; i <= hotel.num_habitaciones; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.dataset.habitacion = i;

        const yaReservada = reservas.some(r => r.hotel_id == hotelId && r.num_habitacion == i);
        if (yaReservada) {
          btn.classList.add('reservada');
          btn.disabled = true;
        }

        btn.onclick = () => {
          document.getElementById('hotel_id').value = hotelId;
          document.getElementById('num_habitacion').value = i;
          formulario.style.display = 'block';
        };

        habitacionesDiv.appendChild(btn);
      }
    }

    // Enviar reserva
    formulario.addEventListener('submit', async e => {
      e.preventDefault();

      const datos = {
        hotel_id: document.getElementById('hotel_id').value,
        num_habitacion: document.getElementById('num_habitacion').value,
        nombre_huesped: document.getElementById('nombre_huesped').value,
        correo: document.getElementById('correo').value,
        celular: document.getElementById('celular').value,
        fecha_inicio: document.getElementById('fecha_inicio').value,
        fecha_fin: document.getElementById('fecha_fin').value
      };

      const res = await fetch('/reserva', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      const result = await res.json();
      if (res.ok) {
        mensajeDiv.textContent = 'Reserva realizada con éxito.';
        formulario.reset();
        formulario.style.display = 'none';
        await cargarReservas();
        generarHabitaciones(datos.hotel_id);
      } else {
        mensajeDiv.textContent = result.error || 'Error al realizar la reserva.';
      }
    });

    // Inicializar
    hotelSelect.addEventListener('change', async () => {
      if (hotelSelect.value) {
        await cargarReservas();
        generarHabitaciones(hotelSelect.value);
      } else {
        habitacionesDiv.innerHTML = '';
        formulario.style.display = 'none';
      }
    });

    cargarHoteles();
    cargarReservas();
  </script>
</body>
</html>
